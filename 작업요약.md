# 작업 요약

## 프로젝트 개요
SVG 도면(`ReferencesFiles/1ST S.L PLAN.svg` 등)을 DXF로 변환하면서, 도면 요소·패턴·텍스트가 CAD 환경에서 기대와 동일하게 표현되도록 파이프라인과 UI를 개선했습니다. 변환기는 PyQt 기반 GUI를 제공하며, 재료/패턴/폰트 매핑을 사용자 정의할 수 있도록 `ReferenceBonsaiSource/style_mapping.json` 구성 파일을 사용합니다.

## 주요 변경 요약
- **SVG 파서(`src/svg_loader.py`)**
  - 좌표계를 DXF 기준으로 뒤집힘 없이 변환하도록 루트 변환행렬 수정.
  - `path` → 폴리라인 변환 시 꼭짓점만 남도록 단순화 로직 도입.
  - 텍스트에 대해 회전·스케일·글꼴 정보를 추출하여 extra 필드에 저장.
  - `<image>`로 삽입된 SVG를 재귀적으로 로드하여 동일 좌표계에 병합.

- **DXF 작성기(`src/dxf_writer.py`)**
  - SVG `fill:url(#pattern)`을 AutoCAD HATCH 패턴으로 매핑하고, `style_mapping.json`의 사용자 정의 값을 반영.
  - 동일 재료(`.material-*`)의 투영선은 얇거나 stroke가 없으면 생략하여 벽 이음선 제거.
  - 텍스트는 회전·스케일·폰트 스타일을 유지한 채 TEXT/MTEXT 엔티티로 출력하고, 필요한 Text Style을 자동 생성.
  - 재료 채움 색상과 선 속성은 SVG 스타일 또는 매핑 설정에 따라 적용.

- **매핑 로직(`src/mapping.py`)**
  - 재료 레이어/색상/선종류/선굵기, 패턴, 폰트에 대한 매핑을 JSON 구성으로 관리.
  - 기본 패턴·폰트 매핑을 제공하고, 사용자 설정으로 덮어쓸 수 있도록 정규화/저장 로직 추가.
  - `MappingManager`는 현재 설정을 반환/저장하는 API를 제공하며, 변환 시 참조됩니다.

- **파이프라인/GUI**
  - `PipelineController`가 `MappingManager` 인스턴스를 유지하며, GUI에서 매핑을 읽고 저장하도록 업데이트.
  - **레이어 매핑** 탭에 재료/패턴/폰트 매핑 테이블과 `맵핑 저장` 버튼을 추가하여 즉석 편집 가능.
  - 변환 실행 시 현재 테이블 값이 즉시 반영되며, 저장 시 `style_mapping.json`이 갱신됩니다.

## 사용 방법 요약
1. 가상환경 활성화: `source .mddoyun/bin/activate`
2. GUI 실행: `python -m src.app`
3. 레이어/재료/패턴/폰트 매핑을 "레이어 매핑" 탭에서 필요에 맞게 수정 후 "맵핑 저장"(선택) → "SVG 로드" → "DXF 변환"
4. 변환 결과는 지정한 경로의 DXF 파일로 출력되며, `style_mapping.json`에 저장된 매핑 규칙이 다음 실행에도 적용됩니다.

## 결과
- DXF에서 해치 패턴은 AutoCAD 표준 패턴으로 표시되고, 동일 재료의 벽 경계선이 사라집니다.
- 텍스트는 SVG와 동일한 방향·글꼴 스타일로 생성되며, user-defined 폰트 매핑을 지원합니다.
- 전체 변환 로그와 경고는 GUI 하단 "변환 로그" 영역에서 확인할 수 있습니다.
